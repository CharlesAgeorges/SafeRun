<%= render "shared/navbar" %>

<div class="run-page">
  <div id="map"
       data-controller="map"
       data-map-api-key-value="<%= ENV['MAPBOX'] %>"
       data-map-markers-value="<%= [{lat: @run.start_point_lat, lng: @run.start_point_lng}].to_json %>">
  </div>

  <div class="run-info">
    <strong><%= @run.start_point %></strong>
    <div><i class="fa-solid fa-user-shield"></i> <%= @run.guardians.map(&:name).join(', ').presence || 'Aucun guardian' %></div>
  </div>

  <% if @run.status.in?(%w[running paused]) %>
    <div class="run-timer">
      <div class="run-timer__time"
           data-controller="timer"
           data-timer-started-at-value="<%= @run.started_at.iso8601 %>"
           data-timer-paused-duration-value="<%= @run.paused_duration %>"
           data-timer-paused-value="<%= @run.status == 'paused' %>">
        00:00:00
      </div>
    </div>
  <% end %>

  <div class="run-controls">
    <% if @run.status == "planned" %>
      <%= link_to start_run_path(@run), class: "run-btn run-btn--play", data: { turbo_method: :patch } do %>
        <i class="fa-solid fa-play"></i>
      <% end %>
    <% end %>

    <% if @run.status == "running" %>
      <%= link_to pause_run_path(@run), class: "run-btn run-btn--pause", data: { turbo_method: :patch } do %>
        <i class="fa-solid fa-pause"></i>
      <% end %>
    <% end %>

    <% if @run.status == "paused" %>
      <%= link_to resume_run_path(@run), class: "run-btn run-btn--play", data: { turbo_method: :patch } do %>
        <i class="fa-solid fa-play"></i>
      <% end %>
    <% end %>

    <% if @run.status.in?(%w[running paused]) %>
      <%= link_to end_run_path(@run), class: "run-btn run-btn--stop", data: { turbo_method: :patch, turbo_confirm: "Es-tu sÃ»r de vouloir terminer ta run ?" } do %>
        <i class="fa-solid fa-stop"></i>
      <% end %>
    <% end %>

    <%= link_to incident_alert_run_path(@run), class: "run-btn run-btn--alert", data: { turbo_method: :post } do %>
      <i class="fa-solid fa-triangle-exclamation"></i>
    <% end %>
  </div>
</div>
